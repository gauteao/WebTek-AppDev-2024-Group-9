<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/litepicker/dist/litepicker.css"/>
    <title>Stay Finder</title>
</head>
<body>
<div class="wrapper">
<header>
    <div id="navbar"></div>
</header>
<div>
    <img src="images/main-image.png" alt="Discover your next stay" class="main-image">
</div>
    <div>
        <form id="booking-form" class="booking-form" method="post">
            <div class="elem-group">
                <select id="destination-selection" name="destination_preference" required>
                    <option value="" disabled selected>Select a destination</option>
                    <option value="ålesund">Ålesund</option>
                    <option value="abu dhabi">Abu Dhabi</option>
                    <option value="amsterdam">Amsterdam</option>
                    <option value="rome">Rome</option>
                    <option value="paris">Paris</option>
                    <option value="bergen">Bergen</option>
                    <option value="oslo">Oslo</option>
                </select>
            </div>
            <div class="elem-group">
                <input id="date-range" name="date_range" placeholder="Check-in and Check-out" required>
            </div>
            <div class="elem-group-guests">
                <input type="number" id="guests" name="total_guests" placeholder="Guests" min="1" required>
            </div>
            <div class="button-group">
                <button type="submit">Search</button>
            </div>
        </form>
    </div>

    <div>
        <h4>Popular Hotels</h4>
    </div>
        <div class="hotel-container">
        </div>
    <div>
        <h4>Your Favorite Hotels</h4>
    </div>
    <div class="favorite-showcase">
        <div class="hotel">
            <img class="hotel-image" src="images/hotel4/1.avif" alt="Hotel 4">
            <h3>Hotel 4</h3>
            <p>Oslo, Norway</p>
            <p>Starting at $200 per night</p>
        </div>
        <div class="hotel">
            <img class="hotel-image" src="images/hotel5/1.avif" alt="Hotel 5">
            <h3>Hotel 5</h3>
            <p>Ålesund, Norway</p>
            <p>Starting at $220 per night</p>
        </div>
        <div class="hotel">
            <img class="hotel-image" src="images/hotel6/1.avif" alt="Hotel 6">
            <h3>Hotel 6</h3>
            <p>Bergen, Norway</p>
            <p>Starting at $250 per night</p>
        </div>
    </div>
    <footer>
        <div id="main-footer"></div>
    </footer>
</div>
<script src="https://cdn.jsdelivr.net/npm/litepicker/dist/litepicker.js"></script>
<script src="script.js"></script>
<script src="authentication.js"></script>
<script src="navigation.js"></script>
<script>

    window.onload = function() {

        // Fetch hotels data from the backend
        fetch('http://localhost:8080/hotels')
            .then(response => response.json())
            .then(hotels => {
                const hotelContainer = document.querySelector('.hotel-container');
                hotels.slice(0,3).forEach((hotel, index) => {
                    const hotelDiv = document.createElement('div');
                    hotelDiv.className = 'hotel';
                    hotelDiv.setAttribute('data-hotel-id', hotel.id); // Add hotel id as data attribute

                    const img = document.createElement('img');
                    img.src = `images/hotel${index + 1}/1.avif`; // Assuming you have hotel1.avif, hotel2.avif, etc. in your images directory
                    img.alt = hotel.name;
                    img.className = 'hotel-image';

                    const h3 = document.createElement('h3');
                    h3.textContent = hotel.name;

                    const locationP = document.createElement('p');
                    locationP.textContent = `${hotel.city}, ${hotel.country}`;

                    // Calculate the minimum price
                    var minPrice = Math.min(...hotel.prices.map(price => price.amount));

                    const priceP = document.createElement('p');
                    priceP.textContent = `Starting at $${minPrice} per night`;

                    hotelDiv.append(img, h3, locationP, priceP);
                    hotelContainer.appendChild(hotelDiv);

                    // Add click event listener to each hotel
                    hotelDiv.addEventListener('click', function() {
                        // Redirect to hotel page with hotel id as query parameter
                        window.location.href = `hotel-page.html?hotelId=${hotel.id}`;
                    });
                });
            })
            .catch((error) => {
                console.error('Error:', error);
            });

    // Initialize Litepicker
        var picker = new Litepicker({
            element: document.getElementById('date-range'),
            singleMode: false,
            format: 'YYYY-MM-DD',
            delimiter: ' to ',
            autoApply: true,
            onSelect: function(date1, date2){
                var checkinDate = date1.format('YYYY-MM-DD');
                var checkoutDate = date2.format('YYYY-MM-DD');
                // Do something with the selected dates
            }
        });


        document.getElementById('booking-form').addEventListener('submit', function (event) {
            // Prevent the form from submitting normally
            event.preventDefault();

            // Get the form inputs
            var cityPreference = document.getElementsByName('destination_preference')[0].value;
            var dateRange = document.getElementsByName('date_range')[0].value;
            var totalGuests = document.getElementsByName('total_guests')[0].value;

            // Split the date range into checkin and checkout dates
            var dates = dateRange.split(' to ');
            var checkinDate = dates[0];
            var checkoutDate = dates[1];

            // Make an AJAX request to the backend endpoint
            var xhr = new XMLHttpRequest();
            xhr.open('GET', 'http://localhost:8080/hotels/search?city=' + encodeURIComponent(cityPreference) +
                '&checkIn=' + encodeURIComponent(checkinDate) +
                '&checkOut=' + encodeURIComponent(checkoutDate) +
                '&guests=' + encodeURIComponent(totalGuests));

            xhr.onload = function () {
                if (xhr.status === 200) {
                    // Parse the response JSON
                    var hotels = JSON.parse(xhr.responseText);

                    // Store the hotels data in sessionStorage to pass it to the next page
                    sessionStorage.setItem('hotels', JSON.stringify(hotels));

                    // Redirect the user to the results page
                    window.location.href = 'results.html';
                } else {
                    console.error('Request failed. Status: ' + xhr.status);
                }
            };

            xhr.send();
        });
        // initialize the commonOnLoad function
        commonOnLoad();
    }
</script>
</body>
</html>